<p-toolbar class="mb-6">
    <ng-template #start>
        <h5 class="!mb-0 text-nowrap">Danh Sách Bài Viết</h5>
    </ng-template>

    <ng-template #end>
        <p-button
            class=""
            label="Mới"
            icon="pi pi-plus"
            severity="primary"
            (onClick)="openNew()"
        />
        <p-button
            class="ml-2"
            icon="pi pi-ellipsis-v"
            (click)="op.toggle($event)"
            [rounded]="true"
            [outlined]="true"
        />
        <p-popover #op>
            <ng-template #content>
                <div class="flex flex-col gap-2 w-full">
                    <p-button
                        label="Xuất bản"
                        icon="pi pi-check"
                        severity="success"
                        outlined
                        class="cursor-pointer"
                        (onClick)="publishSelected(op)"
                        [disabled]="!selectedItems || !selectedItems.length"
                    />
                    <p-button
                        label="Lưu trữ"
                        icon="pi pi-save"
                        severity="secondary"
                        outlined
                        class="cursor-pointer"
                        (onClick)="archiveSelected(op)"
                        [disabled]="!selectedItems || !selectedItems.length"
                    />
                    <p-button
                        label="Bản nháp"
                        icon="pi pi-times"
                        severity="secondary"
                        outlined
                        class="cursor-pointer"
                        (onClick)="unpublishSelected(op)"
                        [disabled]="!selectedItems || !selectedItems.length"
                    />
                    <p-button
                        label="Xóa nhiều"
                        icon="pi pi-trash"
                        severity="danger"
                        outlined
                        class="cursor-pointer"
                        (onClick)="deleteMultiple(); op.hide()"
                        [disabled]="!selectedItems || !selectedItems.length"
                    />
                </div>
            </ng-template>
        </p-popover>
    </ng-template>
</p-toolbar>
<p-table
    #dt
    [value]="items()"
    [rows]="limit"
    [paginator]="true"
    [first]="(page - 1) * limit"
    [lazy]="true"
    (onLazyLoad)="onLazyLoad($event)"
    [globalFilterFields]="['title','excerpt','content']"
    [tableStyle]="{ 'max-width': '100%' }"
    [(selection)]="selectedItems"
    [rowHover]="true"
    dataKey="id"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} posts"
    [showCurrentPageReport]="true"
    [rowsPerPageOptions]="[10, 20, 30, 50, 100]"
    [totalRecords]="totalRecords"
    [loading]="loading"
>
    <ng-template #caption>
        <div class="flex__between flex-col lg:flex-row gap-2">
            <div class="w-full lg:w-96 flex__between gap-2">
                <p-button
                    icon="pi pi-refresh"
                    [rounded]="true"
                    severity="success"
                    (onClick)="resetPagination()"
                />
                <p-iconfield class="w-full">
                    <p-inputicon class="pi pi-search" />
                    <input
                        class="w-full"
                        pInputText
                        type="text"
                        [value]="currentKeyword || ''"
                        (input)="onGlobalFilter(dt, $event)"
                        placeholder="Tìm kiếm tiêu đề, tóm tắt hoặc nội dung..."
                    />
                </p-iconfield>
            </div>
            <div class="flex__end flex-wrap gap-2">
                <p-select
                    [options]="statusOptions"
                    [(ngModel)]="selectedStatus"
                    optionLabel="name"
                    placeholder="Select a Status"
                    class="w-full md:w-48"
                    (ngModelChange)="changeStatus()"
                />
                <p-select
                    [options]="postTypeOptions"
                    [(ngModel)]="selectedPostType"
                    optionLabel="name"
                    class="w-full md:w-52"
                    (ngModelChange)="changeStatus()"
                />
                <p-select
                    [options]="highlightedOptions"
                    [(ngModel)]="selectedIsHighlighted"
                    optionLabel="name"
                    class="w-full md:w-48"
                    (ngModelChange)="changeStatus()"
                />
                <p-select
                    [options]="featuredOptions"
                    [(ngModel)]="selectedIsFeatured"
                    optionLabel="name"
                    class="w-full md:w-56"
                    (ngModelChange)="changeStatus()"
                />
            </div>
        </div>
    </ng-template>

    <ng-template #header>
        <tr>
            <th>
                <p-tableHeaderCheckbox />
            </th>
            <th>Thông tin bài viết</th>
            <th>
                <p class="text-center text-nowrap">Trạng thái</p>
            </th>
            <th>
                <p class="text-center">Thao tác</p>
            </th>
        </tr>
    </ng-template>

    <ng-template #body let-item let-ri="rowIndex">
        <tr>
            <td class="w-0">
                <p-tableCheckbox [value]="item" />
            </td>
            <td>
                <div class="flex items-center gap-x-3">
                    <div>
                        <img
                            [src]="item.featuredImage"
                            [alt]="item.title"
                            class="w-22 h-16 object-cover rounded-md"
                        />
                    </div>
                    <div>
                        <p class="text-nowrap font-bold text-lg !mb-0">
                            {{ item.title || 'N/A' }}
                        </p>
                        <p
                            class="!mb-0 p-0 px-2 rounded-full bg-primary/70 w-fit text-white cursor-pointer"
                            (click)="filterByCategory(item.category?.id)"
                        >
                            {{item.category?.name || 'Chưa phân loại'}}
                        </p>
                        @if (item.publishedAt) {
                        <small class="text-muted"
                            >{{ item.publishedAt | date:'short' }}</small
                        >
                        }
                    </div>
                </div>
            </td>
            <td>
                <p class="flex__middle text-nowrap px-2 py-1 rounded-full "
                    [ngClass]="getBgColorForStatus(item.status)"
                >
                    {{ getStatusName(item.status) }}
                </p>
            </td>
            <td>
                <div class="flex__middle">
                    <p-button
                        icon="pi pi-pencil"
                        class="mr-2"
                        [rounded]="true"
                        [outlined]="true"
                        (click)="editItem(item.id)"
                    />
                    <!-- <p-button
                        icon="pi pi-check"
                        class="mr-2"
                        [rounded]="true"
                        [outlined]="true"
                        tooltip="Xuất bản"
                        (click)="publishItem(item.id)"
                    />
                    <p-button
                        icon="pi pi-times"
                        class="mr-2"
                        [rounded]="true"
                        [outlined]="true"
                        tooltip="Bản nháp"
                        (click)="unpublishItem(item.id)"
                    />
                    <p-button
                        icon="pi pi-save"
                        class="mr-2"
                        [rounded]="true"
                        [outlined]="true"
                        tooltip="Lưu trữ"
                        (click)="archiveItem(item.id)"
                    /> -->
                    <p-button
                        icon="pi pi-trash"
                        severity="danger"
                        [rounded]="true"
                        [outlined]="true"
                        (click)="deleteItem(item)"
                    />
                </div>
            </td>
        </tr>
    </ng-template>
</p-table>
<p-confirmdialog />
