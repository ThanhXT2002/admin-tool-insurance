<div class="card !p-5 flex__between sticky top-16 left-0 right-0 z-50">
    <div class="font-bold text-xl">{{headerTitle}}</div>
    <p-button
        label="Lưu"
        severity="primary"
        (onClick)="submit()"
        [disabled]="submitting"
        [loading]="submitting"
    ></p-button>
</div>

<form [formGroup]="form" (ngSubmit)="submit()" class="space-y-8">
    <div class="card">
        <div class="font-semibold text-xl mb-4">Thông tin cơ bản</div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-8">
                <p-floatlabel variant="in" class="!w-full">
                    <input
                        pInputText
                        id="name"
                        formControlName="name"
                        class="w-full"
                        autocomplete="off"
                        [invalid]="isInvalid('name')"
                    />
                    <label for="name">Tiêu đề bài viết (*)</label>
                </p-floatlabel>
                <!-- Short content (inline editor) -->
                <div>
                    <label for="description" class="mb-4">Mô tả</label>
                    <app-texteditor-common
                        [height]="'150px'"
                        formControlName="description"
                        [invalid]="isInvalid('description')"
                        [placeholder]="'Tóm tắt ngắn...'"
                    ></app-texteditor-common>
                </div>
                <div class="!space-y-3">
                    <label for="shortContent" class="">Nội dung ngắn</label>
                    <app-texteditor-common
                        [height]="'250px'"
                        formControlName="shortContent"
                        [invalid]="isInvalid('shortContent')"
                        [placeholder]="'Nội dung đầu...'"
                    ></app-texteditor-common>
                </div>

                <div>
                    <label for="content">Nội dung chi tiết (*)</label>
                    <app-texteditor-common
                        [height]="'450px'"
                        formControlName="content"
                        [invalid]="isInvalid('content')"
                        [placeholder]="'Nội dung chi tiết...'"
                    ></app-texteditor-common>
                </div>

                <div>
                    <label for="imgs" class="block mb-2"
                        >Danh sách hình ảnh sản phẩm</label
                    >
                    <app-drag-drop-img-list
                        formControlName="imgs"
                        [maxFiles]="10"
                        [class]="isInvalid('imgs') ? 'border-red-500' : ''"
                    ></app-drag-drop-img-list>
                    @if(isInvalid('imgs')) {
                    <small class="text-red-500 mt-1"
                        >Vui lòng thêm ít nhất 1 hình ảnh</small
                    >
                    }
                </div>
            </div>
            <div class="lg:col-span-1 space-y-6">
                <div class="w-full">
                    <label class="featuredImage">Chọn icon (*)</label>
                    <img
                        [src]="displayFeaturedImage"
                        class="h-[150px] w-auto aspect-square overflow-hidden object-cover cursor-pointer mt-3 rounded-md mx-auto"
                        (click)="onFeaturedImageClick()"
                        [ngClass]="{
                            'border border-red-500': isInvalid('featuredImage')
                        }"
                        alt=""
                    />
                </div>

                <p-floatlabel class="w-full" variant="in">
                    <p-select
                        inputId="isSaleOnline"
                        [options]="saleOnlineOptions"
                        optionLabel="name"
                        optionValue="code"
                        class="w-full"
                        variant="filled"
                        formControlName="isSaleOnline"
                    />
                    <label for="isSaleOnline">Có bán online hay không?</label>
                </p-floatlabel>

                <p-floatlabel class="w-full" variant="in">
                    <p-select
                        inputId="isPromotion"
                        [options]="promotionOptions"
                        optionLabel="name"
                        optionValue="code"
                        class="w-full"
                        variant="filled"
                        formControlName="isPromotion"
                    />
                    <label for="isPromotion">Có khuyến mãi hay không?</label>
                </p-floatlabel>

                <p-floatlabel variant="in">
                    <textarea
                        pTextarea
                        id="promotionDetails"
                        formControlName="promotionDetails"
                        rows="5"
                        class="h-full w-full"
                    ></textarea>
                    <label for="promotionDetails">Chi tiết khuyến mãi</label>
                </p-floatlabel>

                <p-floatlabel variant="in">
                    <p-inputnumber
                        class="w-full"
                        inputId="price"
                        mode="currency"
                        currency="VND"
                        locale="vi-VN"
                        formControlName="price"
                        [minFractionDigits]="0"
                        [maxFractionDigits]="0"
                    />
                    <label for="price">Giá sản phẩm VNĐ</label>
                </p-floatlabel>

                <p-floatlabel variant="in">
                    <p-inputnumber
                        class="w-full"
                        inputId="coverage"
                        mode="currency"
                        currency="VND"
                        locale="vi-VN"
                        formControlName="coverage"
                        [minFractionDigits]="0"
                        [maxFractionDigits]="0"
                    />
                    <label for="coverage">Mức độ bảo hiểm VNĐ</label>
                </p-floatlabel>

                <p-floatlabel class="w-full" variant="in">
                    <p-select
                        inputId="term"
                        [options]="termOptions"
                        optionLabel="name"
                        optionValue="code"
                        class="w-full"
                        variant="filled"
                        formControlName="term"
                    />
                    <label for="term">Thời hạn bảo hiểm</label>
                </p-floatlabel>

                <p-floatlabel variant="in">
                    <input
                        pInputText
                        id="targetLink"
                        class="w-full"
                        formControlName="targetLink"
                        autocomplete="off"
                    />
                    <label for="targetLink"
                        >URL: Link mua hàng hoặc trang chi tiết</label
                    >
                </p-floatlabel>

                <p-floatlabel variant="in">
                    <input
                        pInputText
                        id="targetFile"
                        class="w-full"
                        formControlName="targetFile"
                        autocomplete="off"
                    />
                    <label for="targetFile">URL: Link tải về file</label>
                </p-floatlabel>

                <p-floatlabel class="w-full" variant="in">
                    <p-select
                        inputId="active"
                        [options]="statusOptions"
                        optionLabel="name"
                        optionValue="code"
                        class="w-full"
                        variant="filled"
                        formControlName="active"
                    />
                    <label for="active">Chọn trạng thái bài viết</label>
                </p-floatlabel>

                <p-floatlabel variant="in">
                    <p-autocomplete
                        (completeMethod)="searchTags($event)"
                        multiple
                        fluid
                        inputId="tags"
                        formControlName="tags"
                        [typeahead]="false"
                    />
                    <label for="tags"
                        >Đối tượng mục tiêu (Enter để hoàn thành tag)</label
                    >
                </p-floatlabel>

                <p-floatlabel variant="in">
                    <p-autocomplete
                        (completeMethod)="searchMetaKeywords($event)"
                        multiple
                        fluid
                        inputId="metaKeywords"
                        formControlName="metaKeywords"
                        [typeahead]="false"
                    />
                    <label for="metaKeywords"
                        >Từ khóa tìm kiếm nội bộ (Enter để hoàn thành
                        tag)</label
                    >
                </p-floatlabel>

                <p-floatlabel class="w-full" variant="in">
                    <input
                        pInputText
                        id="priority"
                        formControlName="priority"
                        type="number"
                        class="w-full"
                        autocomplete="off"
                        [invalid]="isInvalid('priority')"
                    />
                    <label for="priority">Độ ưu tiên </label>
                </p-floatlabel>

                <p-floatlabel class="w-full" variant="in">
                    <p-select
                        inputId="isHighlighted"
                        [options]="booleanOptions"
                        optionLabel="label"
                        optionValue="value"
                        class="w-full"
                        variant="filled"
                        formControlName="isHighlighted"
                    />
                    <label for="isHighlighted">Có phải bài viết nổi bật?</label>
                </p-floatlabel>

                <p-floatlabel class="w-full" variant="in">
                    <p-select
                        inputId="isFeatured"
                        [options]="booleanOptions"
                        optionLabel="label"
                        optionValue="value"
                        class="w-full"
                        variant="filled"
                        formControlName="isFeatured"
                    />
                    <label for="isFeatured">Có xuất hiện ở trang chủ?</label>
                </p-floatlabel>

                <p-floatlabel variant="in">
                    <textarea
                        pTextarea
                        id="note"
                        formControlName="note"
                        rows="7"
                        class="h-full w-full"
                    ></textarea>
                    <label for="note">Ghi chú nội bộ</label>
                </p-floatlabel>

                @if(isEditMode()){
                <div class="flex__middle w-full gap-4">
                    <p-floatlabel variant="in" class="!w-full">
                        <input
                            pInputText
                            id="createdAt"
                            disabled
                            [value]="createdAt ? (createdAt | date:'HH:mm dd/MM/yyyy':'Asia/Ho_Chi_Minh') : ''"
                            class="w-full"
                            autocomplete="off"
                        />
                        <label for="createdAt">Ngày tạo</label>
                    </p-floatlabel>
                    <p-floatlabel variant="in" class="!w-full">
                        <input
                            pInputText
                            id="updatedAt"
                            disabled
                            [value]="updatedAt ? (updatedAt | date:'HH:mm dd/MM/yyyy':'Asia/Ho_Chi_Minh') : ''"
                            class="w-full"
                            autocomplete="off"
                        />
                        <label for="updatedAt">Cập nhật mới nhất</label>
                    </p-floatlabel>
                </div>
                <div class="flex__middle w-full gap-4">
                    <p-floatlabel variant="in" class="!w-full">
                        <input
                            pInputText
                            id="createdAt"
                            disabled
                            [value]="createdBy"
                            class="w-full"
                            autocomplete="off"
                        />
                        <label for="createdAt">Người tạo</label>
                    </p-floatlabel>
                    <p-floatlabel variant="in" class="!w-full">
                        <input
                            pInputText
                            id="updatedAt"
                            disabled
                            [value]="updatedBy"
                            class="w-full"
                            autocomplete="off"
                        />
                        <label for="updatedAt">Người cập nhật</label>
                    </p-floatlabel>
                </div>
                }
            </div>
        </div>
    </div>
    <div>
        <app-seo
            [initialValue]="seoData"
            [parentName]="form.get('title')?.value"
            [segment]="'post'"
            [createMode]="!isEditMode()"
            (valueChange)="seoData = $event"
            (statusChange)="seoStatus = $event"
        ></app-seo>
    </div>
</form>
