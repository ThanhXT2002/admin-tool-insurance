<div class="card">
    <div class="flex__between flex-col lg:flex-row gap-2 mb-4">
        <div class="flex__between w-full lg:w-auto">
            <h5 class="!mb-0 text-nowrap">Danh sách Menu Items</h5>
            <div class="lg:hidden">
                <p-button
                    label="Mới"
                    icon="pi pi-plus"
                    severity="primary"
                    (onClick)="addNew()"
                />
            </div>
        </div>
        <div class="flex__end flex-wrap gap-2">
            <!-- Status Filter -->
            <p-select
                [options]="statusOptions"
                [(ngModel)]="selectedStatus"
                optionLabel="name"
                placeholder="Chọn trạng thái"
                class="w-full md:w-48"
                (ngModelChange)="changeStatus()"
            />

            <!-- Add New Button -->
            <p-button
                class="hidden lg:block"
                label="Mới"
                icon="pi pi-plus"
                severity="primary"
                (onClick)="addNew()"
            />
        </div>
    </div>

    <!-- TreeTable -->
    <p-treetable
        #tt
        [value]="files"
        [columns]="cols"
        [scrollable]="true"
        [tableStyle]="{ 'min-width': '70rem' }"
        selectionMode="checkbox"
        [(selection)]="selectedNodes"
        (selectionChange)="handleSelectionChange($event)"
        [loading]="loading"
    >
        <ng-template #header let-columns>
            <tr>
                <th>Tên Menu</th>
                <th>URL</th>
                <th><p class="text-center">Thứ tự</p></th>
                <th><p class="text-center">Trạng thái</p></th>
                <th><p class="text-end">Thao tác</p></th>
            </tr>
        </ng-template>

        <ng-template
            #body
            let-rowNode
            let-rowData="rowData"
            let-columns="columns"
        >
            <tr [ttRow]="rowNode">
                @for (col of columns; track col.field; let i = $index) {
                <td>
                    @if (col.field === 'label') {
                    <div class="flex__start">
                        <p-treetable-toggler
                            [rowNode]="rowNode"
                        ></p-treetable-toggler>
                        @if (rowData.icon) {
                        <i [class]="rowData.icon + ' mr-2'"></i>
                        }
                        <span class="text-nowrap">{{ rowData.label }}</span>
                    </div>
                    } @if (col.field === 'url') {
                    <div class="text-sm">
                        @if (rowData.url) {
                        <div>
                            <i class="pi pi-link mr-1"></i>
                            {{ rowData.url }}
                        </div>
                        } @if (rowData.routerLink) {
                        <div class="text-blue-500">
                            <i class="pi pi-paperclip mr-1"></i>
                            {{ rowData.routerLink }}
                        </div>
                        } @if (!rowData.url && !rowData.routerLink) {
                        <span class="text-gray-400">-</span>
                        }
                    </div>
                    } @if (col.field === 'order') {
                    <div class="flex__middle">
                        <span class="font-bold">{{ rowData.order }}</span>
                    </div>
                    } @if (col.field === 'active') {
                    <div class="flex__middle">
                        <p-toggleswitch
                            [ngModel]="rowData.active"
                            (onChange)="toggleActive(rowData)"
                        />
                    </div>
                    } @if (col.field === 'actions') {
                    <div class="flex__end gap-2">
                        <p-button
                            icon="pi pi-pencil"
                            [rounded]="true"
                            [outlined]="true"
                            size="small"
                            (click)="openEdit(rowData)"
                        />
                        <p-button
                            icon="pi pi-trash"
                            severity="danger"
                            [rounded]="true"
                            [outlined]="true"
                            size="small"
                            (click)="deleteItem(rowData)"
                        />
                    </div>
                    }
                </td>
                }
            </tr>
        </ng-template>
    </p-treetable>
    <p-confirmdialog />
</div>

<!-- <app-menu-item-form
 [(isShow)]="isFormOpen"
    [isEditMode]="isEditing"
    [dataEdit]="selectedMenu"
    (saved)="onMenuSaved($event)"/> -->
